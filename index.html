<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Online Classes</title>

  <!-- Font Awesome for cart icon -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
  />

  <!-- Custom stylesheet -->
  <link rel="stylesheet" href="style.css" />

  <!-- Vue.js framework -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
</head>

<body>
  <!-- Main Vue app container -->
  <div id="app">
    
    <!-- SIGN IN PAGE - Shows first when app loads -->
    <div v-if="!isSignedIn" class="signin-page">
      <div class="signin-box">
        <h1>{{ sitename }}</h1>
        <h2>Sign In</h2>
        
        <p>
          <strong>Username:</strong>
          <input type="text" v-model="signInUsername" placeholder="Enter username" />
        </p>
        
        <p>
          <strong>Password:</strong>
          <input type="password" v-model="signInPassword" placeholder="Enter password" />
        </p>
        
        <button @click="handleSignIn" class="signin-btn-large">Sign In</button>
      </div>
    </div>

    <!-- MAIN APP - Shows after sign in -->
    <div v-else>
    
    <!-- Header with title and buttons -->
    <header>
      <h1>{{ sitename }}</h1>
      <div class="header-buttons">
        <button @click="showCheckout">
          <span class="fas fa-shopping-cart"></span>
          Cart ({{ cartItemCount }})
        </button>
      </div>
    </header>

    <main>
      <!-- CLASSES LIST PAGE -->
      <div v-if="showProduct">
        
        <!-- Search box -->
        <input 
          type="text" 
          v-model="searchQuery" 
          placeholder="Search classes..."
          class="search-box"
        />
        
        <!-- Sort options with radio buttons -->
        <div class="sort-section">
          <strong>Sort by</strong>
          <label>
            <input type="radio" value="subject" v-model="sortBy" />
            Subject
          </label>
          <label>
            <input type="radio" value="location" v-model="sortBy" />
            Location
          </label>
          <label>
            <input type="radio" value="price" v-model="sortBy" />
            Price
          </label>
          <label>
            <input type="radio" value="availability" v-model="sortBy" />
            Availability
          </label>
          
          <strong style="margin-top: 15px;">Order</strong>
          <label>
            <input type="radio" value="ascending" v-model="sortOrder" />
            Ascending
          </label>
          <label>
            <input type="radio" value="descending" v-model="sortOrder" />
            Descending
          </label>
        </div>

        <!-- Show message if no results -->
        <p v-if="filteredProducts.length === 0" class="no-results">
          No classes found.
        </p>
        
        <!-- Loop through each class -->
        <div class="classes-grid">
          <div v-for="product in filteredProducts" :key="product.id" class="class-card">
          
          <img :src="product.image" :alt="product.title" />
          
          <h2>{{ product.title }}</h2>
          
          <!-- Subject badge -->
          <span class="subject-badge">{{ product.category }}</span>
          
          <p>{{ product.description }}</p>
          
          <p><strong>Location:</strong> {{ product.location }}</p>
          <p><strong>Price:</strong> £{{ product.price.toFixed(2) }}</p>

          <!-- Star rating -->
          <div class="rating">
            <span v-for="n in product.rating">★</span>
            <span v-for="n in 5 - product.rating">☆</span>
          </div>

          <!-- Availability status -->
          <p class="availability">
            <span v-if="product.availableInventory === cartCount(product.id)">
              Fully Booked
            </span>
            <span v-else-if="product.availableInventory - cartCount(product.id) < 20">
              {{ product.availableInventory - cartCount(product.id) }} spots left
            </span>
            <span v-else>
              {{ product.availableInventory }} spots available
            </span>
          </p>

          <!-- Book button -->
          <button @click="addToCart(product)" v-if="canAddToCart(product)">
            Book Class
          </button>
          <button disabled v-else>
            Fully Booked
          </button>
        </div>
        </div>
      </div>

      <!-- CHECKOUT PAGE -->
      <div v-else>
        <div class="checkout-header">
          <h2>Checkout</h2>
          <button @click="backToClasses" class="back-btn">
            <span class="fas fa-arrow-left"></span> Back to Classes
          </button>
        </div>

        <!-- Cart items -->
        <div class="cart-section">
          <h3>Your Classes</h3>
          
          <p v-if="cart.length === 0">Your cart is empty</p>
          
          <div v-else>
            <!-- Each cart item -->
            <div v-for="item in cartItems" :key="item.product.id" class="cart-row">
              
              <div class="cart-info">
                <strong>{{ item.product.title }}</strong>
                <p>{{ item.product.category }} - {{ item.product.location }}</p>
                <p>£{{ item.product.price.toFixed(2) }} each</p>
              </div>
              
              <!-- Quantity buttons -->
              <div class="cart-quantity">
                <button @click="removeFromCart(item.product.id)">-</button>
                <span>{{ item.quantity }}</span>
                <button @click="addToCart(item.product)" v-if="canAddToCart(item.product)">+</button>
                <button disabled v-else>+</button>
              </div>
              
              <div class="cart-price">
                £{{ item.subtotal }}
              </div>
              
              <button @click="removeAllFromCart(item.product.id)" class="remove-btn">
                Remove
              </button>
            </div>
            
            <!-- Total price -->
            <div class="cart-total">
              Total: £{{ getCartTotal() }}
            </div>
          </div>
        </div>

        <!-- Customer form -->
        <div class="form-section">
          <h3>Your Details</h3>
          
          <p>
            <strong>First Name:</strong>
            <input v-model.trim="order.firstName" placeholder="First name" />
          </p>

          <p>
            <strong>Last Name:</strong>
            <input v-model.trim="order.lastName" placeholder="Last name" />
          </p>

          <p>
            <strong>Address:</strong>
            <input v-model="order.address" placeholder="Address" />
          </p>

          <p>
            <strong>City:</strong>
            <input v-model="order.city" placeholder="City" />
          </p>

          <p>
            <strong>County:</strong>
            <select v-model="order.county">
              <option disabled value="">Select County</option>
              <option v-for="(county, key) in counties" v-bind:value="county">
                {{ key }}
              </option>
            </select>
          </p>

          <p>
            <strong>Postcode:</strong>
            <input v-model="order.zip" placeholder="Postcode" />
          </p>

          <button v-on:click="submitForm">Place Order</button>
        </div>

        <!-- Order summary -->
        <div class="order-summary">
          <h3>Order Summary</h3>
          <p>Name: {{ order.firstName }} {{ order.lastName }}</p>
          <p>Address: {{ order.address }}</p>
          <p>City: {{ order.city }}</p>
          <p>County: {{ order.county }}</p>
          <p>Postcode: {{ order.zip }}</p>
        </div>

      </div>

    </main>
    </div>
  </div>

  <!-- Load JavaScript files -->
  <script src="products.js"></script>
  <script src="app.js"></script>
</body>
</html>
